CREATE EXTENSION pgdms CASCADE;
NOTICE:  installing required extension "uuid-ossp"
SELECT hello();
     hello     
---------------
 Hello, World!
(1 row)

CREATE TABLE public.d
(
    key pgdms_did NOT NULL,
    num integer,
    CONSTRAINT d_pkey PRIMARY KEY (key)
)
WITH (
    OIDS = FALSE
)
TABLESPACE pg_default;
CREATE SEQUENCE public.dup_key_seq
    INCREMENT 1
    START 1
    MINVALUE 1
    MAXVALUE 2147483647
    CACHE 1;
CREATE TABLE public.dup
(
    key integer NOT NULL DEFAULT nextval('dup_key_seq'::regclass),
    d pgdms_didup,
    name text COLLATE pg_catalog."default",
    CONSTRAINT dup_pkey PRIMARY KEY (key),
    CONSTRAINT dup_d_fkey FOREIGN KEY (d)
        REFERENCES public.d (key) MATCH SIMPLE
        ON UPDATE NO ACTION
        ON DELETE NO ACTION
)
WITH (
    OIDS = FALSE
)
TABLESPACE pg_default;
CREATE SEQUENCE public.dn_key_seq
    INCREMENT 1
    START 1
    MINVALUE 1
    MAXVALUE 2147483647
    CACHE 1;
CREATE TABLE public.dn
(
    key integer NOT NULL DEFAULT nextval('dn_key_seq'::regclass),
    d pgdms_didn,
    name text COLLATE pg_catalog."default",
    CONSTRAINT dn_pkey PRIMARY KEY (key),
    CONSTRAINT dn_d_fkey FOREIGN KEY (d)
        REFERENCES public.d (key) MATCH SIMPLE
        ON UPDATE NO ACTION
        ON DELETE NO ACTION
)
WITH (
    OIDS = FALSE
)
TABLESPACE pg_default;
INSERT INTO public.d(
	key, num)
	VALUES (('2604bebd-3369-423c-be17-9e27e50c823b'::uuid, '2604bebd-3369-423c-be17-9e27e50c823b'::uuid, 0), 1);
	
INSERT INTO public.d(
	key, num)
	VALUES (('2604bebd-3369-423c-be17-9e27e50c823b'::uuid, '61f8cbf2-18ea-4a05-ace1-bd5878c453dd'::uuid, 1), 2);
	
SELECT key::uuid FROM public.d where num = 1;	
                 key                  
--------------------------------------
 2604bebd-3369-423c-be17-9e27e50c823b
(1 row)

INSERT INTO public.dup(
	 d, name)
	VALUES ( (SELECT key::uuid FROM public.d where num = 1), 'a1');
	
	
INSERT INTO public.dn(
	 d, name)
	VALUES ( (SELECT key::uuid FROM public.d where num = 1), 'a1');
	
SELECT d.num FROM d,dup WHERE d.key = dup.d;
 num 
-----
   2
(1 row)

SELECT d.num FROM d,dn WHERE d.key = dn.d;	
 num 
-----
   1
(1 row)

INSERT INTO public.d(
	key, num)
	VALUES ('2604bebd-3369-423c-be17-9e27e50c823b'::uuid, 3);
SELECT count(*) FROM public.d;	
 count 
-------
     3
(1 row)

	
	
